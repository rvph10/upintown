---
import Transition from '../components/Transition.astro';
import Menu from '../components/Menu.astro';
import Footer from '../components/Footer.astro';
import SEO from '../components/SEO.astro';
import ServiceSchema from '../components/ServiceSchema.astro';
import { inject } from '@vercel/analytics';
import SpeedInsights from '@vercel/speed-insights/astro';
import { SITE_URL } from '../data/seo-config';

// Import global styles
import '../styles/globals.css';
import '../styles/transition.css';
import '../styles/menu.css';
import '../styles/footer.css';

interface Props {
  title?: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article';
  noindex?: boolean;
  keywords?: string[];
  includeServiceSchema?: boolean;
}

const {
  title = 'upintown | Digital Solutions',
  description = 'Digital solutions crafted with precision and creativity',
  image = '/og-image.jpg',
  type = 'website',
  noindex = false,
  keywords = [],
  includeServiceSchema = false,
} = Astro.props;

// Initialize Vercel Analytics & Speed Insights
inject();

// Site URL for canonical and schema
const siteUrl = Astro.site?.toString() || SITE_URL;

// Schema.org Organization structured data
const organizationSchema = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  name: 'upintown',
  url: siteUrl,
  logo: `${siteUrl}/global/logo.svg`,
  description: 'Digital solutions crafted with precision and creativity',
  foundingDate: '2024',
  sameAs: ['https://github.com/rvph10'],
  contactPoint: {
    '@type': 'ContactPoint',
    email: 'contact@upintown.dev',
    contactType: 'Customer Service',
    availableLanguage: ['English'],
  },
  address: {
    '@type': 'PostalAddress',
    addressCountry: 'US',
  },
  areaServed: 'Worldwide',
  knowsAbout: [
    'Web Development',
    'UI/UX Design',
    'Frontend Development',
    'Digital Solutions',
    'Astro.js',
    'React',
    'TypeScript',
    'GSAP Animation',
  ],
};

// WebSite schema for search box
const websiteSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: 'upintown',
  url: siteUrl,
  description: 'Digital solutions crafted with precision and creativity',
  publisher: {
    '@type': 'Organization',
    name: 'upintown',
    logo: {
      '@type': 'ImageObject',
      url: `${siteUrl}/global/logo.svg`,
    },
  },
  potentialAction: {
    '@type': 'SearchAction',
    target: {
      '@type': 'EntryPoint',
      urlTemplate: `${siteUrl}/?s={search_term_string}`,
    },
    'query-input': 'required name=search_term_string',
  },
};
---

<!doctype html>
<html lang="en" prefix="og: https://ogp.me/ns#">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#f9f4eb" />
    <meta name="format-detection" content="telephone=no" />

    <!-- SEO Meta Tags -->
    <SEO
      title={title}
      description={description}
      image={image}
      type={type}
      noindex={noindex}
      keywords={keywords}
    />

    <!-- Preconnect to external domains for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- DNS Prefetch for external resources -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" />

    <!-- Load fonts via link tag for better performance (non-blocking, using media swap technique) -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@900&family=DM+Mono:wght@500&family=Host+Grotesk:wght@400;500;600&display=swap"
      media="print"
      onload="this.media='all';this.onload=null"
    />
    <noscript>
      <link
        rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@900&family=DM+Mono:wght@500&family=Host+Grotesk:wght@400;500;600&display=swap"
      />
    </noscript>

    <!-- Preload critical logo image to prevent layout shift -->
    <link rel="preload" href="/global/logo.png" as="image" type="image/png" />

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" sizes="48x48" />
    <link rel="icon" href="/global/favicon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="/global/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- Page-specific styles are imported in the page components themselves -->

    <!-- Schema.org structured data -->
    <script is:inline type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />
    <script is:inline type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />

    <!-- Service Schema (for home page) -->
    {includeServiceSchema && <ServiceSchema />}

    <!-- Verification tags (add when ready) -->
    <!-- <meta name="google-site-verification" content="YOUR_VERIFICATION_CODE" /> -->
    <!-- <meta name="msvalidate.01" content="YOUR_BING_VERIFICATION_CODE" /> -->

    <!-- Security headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN" />
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
  </head>
  <body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <Transition />
    <SpeedInsights />
    <Menu />

    <!-- Main content -->
    <main id="main-content" role="main">
      <slot />
    </main>

    <Footer />

    <!-- Global scripts - loaded as modules so dependencies are bundled -->
    <script>
      import '/src/scripts/lenis-scroll.js';
      import '/src/scripts/transition.js';
      import '/src/scripts/menu.js';
    </script>
  </body>
</html>

<style>
  /* Skip to main content link for accessibility */
  .skip-link {
    position: absolute;
    top: -40px;
    left: 0;
    background: var(--base-300);
    color: var(--base-100);
    padding: 8px 16px;
    text-decoration: none;
    z-index: 100;
    font-family: 'Host Grotesk', sans-serif;
    font-size: 0.9rem;
    transition: top 0.2s ease;
  }

  .skip-link:focus {
    top: 0;
  }
</style>
